{"remainingRequest":"/Users/bx/logistics-design/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/bx/logistics-design/frontend/src/views/production/productionPlan.vue?vue&type=style&index=0&id=61f0ba24&scoped=true&lang=css","dependencies":[{"path":"/Users/bx/logistics-design/frontend/src/views/production/productionPlan.vue","mtime":1747836160169},{"path":"/Users/bx/logistics-design/frontend/node_modules/css-loader/dist/cjs.js","mtime":1747185535288},{"path":"/Users/bx/logistics-design/frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1747185534140},{"path":"/Users/bx/logistics-design/frontend/node_modules/postcss-loader/src/index.js","mtime":1747185535100},{"path":"/Users/bx/logistics-design/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1747185535160},{"path":"/Users/bx/logistics-design/frontend/node_modules/vue-loader/lib/index.js","mtime":1747185534034}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5maWx0ZXItY29udGFpbmVyIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9Ci5maWx0ZXItaXRlbS1jb250YWluZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC13cmFwOiB3cmFwOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KLmZpbHRlci1pdGVtIHsKICBtYXJnaW4tcmlnaHQ6IDE1cHg7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KLmZpbHRlci1pdGVtIC5sYWJlbCB7CiAgbWFyZ2luLXJpZ2h0OiA1cHg7Cn0KLnBhZ2luYXRpb24tY29udGFpbmVyIHsKICBtYXJnaW4tdG9wOiAyMHB4OwogIHRleHQtYWxpZ246IHJpZ2h0Owp9Ci5jYWxlbmRhci1kYXkgewogIGhlaWdodDogMTAwJTsKICBwYWRkaW5nOiAycHg7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKfQouZGF5LW51bWJlciB7CiAgZm9udC1zaXplOiAxNHB4OwogIG1hcmdpbi1ib3R0b206IDVweDsKfQouY2FsZW5kYXItZXZlbnQgewogIGZvbnQtc2l6ZTogMTJweDsKICBwYWRkaW5nOiAycHggNHB4OwogIG1hcmdpbi1ib3R0b206IDJweDsKICBib3JkZXItcmFkaXVzOiAycHg7CiAgY29sb3I6ICNmZmY7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9Ci5zdGF0dXMtMCB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzQwOUVGRjsKfQouc3RhdHVzLTEgewogIGJhY2tncm91bmQtY29sb3I6ICM2N0MyM0E7Cn0KLnN0YXR1cy0yIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjRTZBMjNDOwp9Ci5zdGF0dXMtMyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI0Y1NkM2QzsKfQoud2Vlay12aWV3IHsKICBib3JkZXI6IDFweCBzb2xpZCAjRUJFRUY1OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoud2Vlay1oZWFkZXIgewogIGRpc3BsYXk6IGZsZXg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjdmYTsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0VCRUVGNTsKfQoud2Vlay1kYXkgewogIGZsZXg6IDE7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHBhZGRpbmc6IDEwcHg7CiAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgI0VCRUVGNTsKfQoud2Vlay1kYXk6bGFzdC1jaGlsZCB7CiAgYm9yZGVyLXJpZ2h0OiBub25lOwp9Ci5kYXktbmFtZSB7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgbWFyZ2luLWJvdHRvbTogNXB4Owp9Ci53ZWVrLWJvZHkgewogIGRpc3BsYXk6IGZsZXg7CiAgaGVpZ2h0OiA0MDBweDsKfQoud2Vlay1kYXktY29udGVudCB7CiAgZmxleDogMTsKICBwYWRkaW5nOiAxMHB4OwogIGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNFQkVFRjU7CiAgb3ZlcmZsb3cteTogYXV0bzsKfQoud2Vlay1kYXktY29udGVudDpsYXN0LWNoaWxkIHsKICBib3JkZXItcmlnaHQ6IG5vbmU7Cn0KLndlZWstZXZlbnQgewogIHBhZGRpbmc6IDEwcHg7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgY29sb3I6ICNmZmY7Cn0KLmV2ZW50LXRpbWUgewogIGZvbnQtc2l6ZTogMTJweDsKICBtYXJnaW4tYm90dG9tOiA1cHg7Cn0KLmV2ZW50LXRpdGxlIHsKICBmb250LXdlaWdodDogYm9sZDsKICBtYXJnaW4tYm90dG9tOiA1cHg7Cn0KLmV2ZW50LXF1YW50aXR5IHsKICBmb250LXNpemU6IDEycHg7Cn0K"},{"version":3,"sources":["productionPlan.vue"],"names":[],"mappings":";AAouBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"productionPlan.vue","sourceRoot":"src/views/production","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-card class=\"filter-container\">\n      <div slot=\"header\">\n        <span>排产计划管理</span>\n        <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"handleCreatePlan\">创建排产计划</el-button>\n      </div>\n      <div class=\"filter-item-container\">\n        <div class=\"filter-item\">\n          <span class=\"label\">计划编号：</span>\n          <el-input v-model=\"filterForm.planNo\" placeholder=\"请输入计划编号\" style=\"width: 150px\" clearable />\n        </div>\n        <div class=\"filter-item\">\n          <span class=\"label\">订单编号：</span>\n          <el-input v-model=\"filterForm.orderNo\" placeholder=\"请输入订单编号\" style=\"width: 150px\" clearable />\n        </div>\n        <div class=\"filter-item\">\n          <span class=\"label\">计划状态：</span>\n          <el-select v-model=\"filterForm.status\" placeholder=\"请选择\" style=\"width: 150px\" clearable>\n            <el-option\n              v-for=\"item in statusOptions\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </div>\n        <div class=\"filter-item\">\n          <span class=\"label\">生产日期：</span>\n          <el-date-picker\n            v-model=\"dateRange\"\n            type=\"daterange\"\n            align=\"right\"\n            unlink-panels\n            range-separator=\"至\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            style=\"width: 260px\"\n            value-format=\"yyyy-MM-dd\"\n          />\n        </div>\n        <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"handleFilter\">查询</el-button>\n        <el-button icon=\"el-icon-refresh\" @click=\"resetFilter\">重置</el-button>\n      </div>\n    </el-card>\n\n    <!-- 日历视图 -->\n    <el-card style=\"margin-top: 20px;\">\n      <div slot=\"header\">\n        <span>排产计划日历视图</span>\n        <div style=\"float: right; display: flex; align-items: center;\">\n          <div style=\"margin-right: 20px;\">\n            <el-tag size=\"mini\" type=\"primary\">待生产</el-tag>\n            <el-tag size=\"mini\" type=\"success\">生产中</el-tag>\n            <el-tag size=\"mini\" type=\"warning\">已完成</el-tag>\n            <el-tag size=\"mini\" type=\"danger\">已取消</el-tag>\n          </div>\n          <el-radio-group v-model=\"calendarView\" size=\"mini\">\n            <el-radio-button label=\"month\">月视图</el-radio-button>\n            <el-radio-button label=\"week\">周视图</el-radio-button>\n          </el-radio-group>\n        </div>\n      </div>\n      <div style=\"margin-top: 10px;\">\n        <el-calendar v-if=\"calendarView === 'month'\">\n          <template slot=\"dateCell\" slot-scope=\"{date, data}\">\n            <div class=\"calendar-day\">\n              <div class=\"day-number\">{{ data.day.split('-')[2] }}</div>\n              <div v-for=\"plan in getCalendarPlans(date)\" :key=\"plan.id\" class=\"calendar-event\" :class=\"'status-' + plan.status\">\n                {{ plan.productName }} ({{ plan.planQuantity }}件)\n              </div>\n            </div>\n          </template>\n        </el-calendar>\n        <div v-else class=\"week-view\">\n          <div class=\"week-header\">\n            <div class=\"week-day\" v-for=\"(day, index) in weekDays\" :key=\"index\">\n              <div class=\"day-name\">{{ day.dayName }}</div>\n              <div class=\"day-date\">{{ day.date }}</div>\n            </div>\n          </div>\n          <div class=\"week-body\">\n            <div class=\"week-day-content\" v-for=\"(day, index) in weekDays\" :key=\"index\">\n              <div v-for=\"plan in day.plans\" :key=\"plan.id\" class=\"week-event\" :class=\"'status-' + plan.status\">\n                <div class=\"event-time\">{{ plan.startTime }} - {{ plan.endTime }}</div>\n                <div class=\"event-title\">{{ plan.productName }}</div>\n                <div class=\"event-quantity\">数量: {{ plan.planQuantity }}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 列表视图 -->\n    <el-card style=\"margin-top: 20px;\">\n      <div slot=\"header\">\n        <span>排产计划列表</span>\n      </div>\n      <el-table\n        v-loading=\"tableLoading\"\n        :data=\"tableData\"\n        border\n        style=\"width: 100%\"\n      >\n        <el-table-column prop=\"planNo\" label=\"计划编号\" width=\"150\" />\n        <el-table-column prop=\"orderNo\" label=\"关联订单\" width=\"150\" />\n        <el-table-column prop=\"productName\" label=\"产品名称\" width=\"150\" />\n        <el-table-column prop=\"planQuantity\" label=\"计划数量\" width=\"100\" />\n        <el-table-column prop=\"actualQuantity\" label=\"实际数量\" width=\"100\" />\n        <el-table-column label=\"完成率\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <el-progress :percentage=\"calculateProgress(scope.row)\" :format=\"percentFormat\" />\n          </template>\n        </el-table-column>\n        <el-table-column label=\"生产日期\" width=\"200\">\n          <template slot-scope=\"scope\">\n            {{ scope.row.startDate }} 至 {{ scope.row.endDate }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"状态\" width=\"100\">\n          <template slot-scope=\"scope\">\n            <el-tag :type=\"getStatusType(scope.row.status)\">{{ getStatusName(scope.row.status) }}</el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"220\" fixed=\"right\">\n          <template slot-scope=\"scope\">\n            <el-button type=\"text\" @click=\"handleDetail(scope.row)\">详情</el-button>\n            <el-button type=\"text\" v-if=\"scope.row.status === 0\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n            <el-button type=\"text\" v-if=\"scope.row.status === 0\" @click=\"handleStart(scope.row)\">开始生产</el-button>\n            <el-button type=\"text\" v-if=\"scope.row.status === 1\" @click=\"handleComplete(scope.row)\">完成</el-button>\n            <el-button type=\"text\" v-if=\"scope.row.status === 0\" @click=\"handleCancel(scope.row)\">取消</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n\n      <div class=\"pagination-container\">\n        <el-pagination\n          background\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n          :current-page=\"filterForm.pageNum\"\n          :page-sizes=\"[10, 20, 30, 50]\"\n          :page-size=\"filterForm.pageSize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"total\"\n        />\n      </div>\n    </el-card>\n\n    <!-- 创建/编辑排产计划对话框 -->\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogVisible\" width=\"650px\">\n      <el-form :model=\"planForm\" :rules=\"planRules\" ref=\"planForm\" label-width=\"100px\">\n        <el-form-item label=\"关联订单\" prop=\"orderId\">\n          <el-select v-model=\"planForm.orderId\" placeholder=\"请选择订单\" style=\"width: 100%\">\n            <el-option\n              v-for=\"item in orderOptions\"\n              :key=\"item.value\"\n              :label=\"`${item.label} (${item.orderNo})`\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"生产产品\" prop=\"productId\">\n          <el-select v-model=\"planForm.productId\" placeholder=\"请选择产品\" style=\"width: 100%\">\n            <el-option\n              v-for=\"item in productOptions\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"计划数量\" prop=\"planQuantity\">\n          <el-input-number v-model=\"planForm.planQuantity\" :min=\"1\" style=\"width: 200px\" />\n        </el-form-item>\n        <el-form-item label=\"生产日期\" prop=\"dateRange\">\n          <el-date-picker\n            v-model=\"planForm.dateRange\"\n            type=\"daterange\"\n            range-separator=\"至\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            style=\"width: 100%\"\n            value-format=\"yyyy-MM-dd\"\n          />\n        </el-form-item>\n        <el-form-item label=\"优先级\" prop=\"priority\">\n          <el-select v-model=\"planForm.priority\" placeholder=\"请选择优先级\" style=\"width: 200px\">\n            <el-option label=\"低\" :value=\"0\" />\n            <el-option label=\"中\" :value=\"1\" />\n            <el-option label=\"高\" :value=\"2\" />\n            <el-option label=\"紧急\" :value=\"3\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"备注\" prop=\"remark\">\n          <el-input type=\"textarea\" v-model=\"planForm.remark\" rows=\"3\" />\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"submitPlan\" :loading=\"submitLoading\">确 定</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n// import { getProductionPlanList, updateProductionPlan } from '@/api/productionPlan'\nimport { productionApi } from '@/utils/mockUtils'\nimport { getConstants } from '@/utils/mockUtils'\nimport moment from 'moment'\n\nexport default {\n  name: 'ProductionPlan',\n  data() {\n    return {\n      // 查询参数\n      queryParams: {\n        pageNum: 1,\n        pageSize: 10,\n        orderNo: '',\n        customerName: '',\n        status: '',\n        dateRange: []\n      },\n      // 状态选项\n      statusOptions: getConstants().orderStatus,\n      // 表格数据\n      tableData: [],\n      // 加载状态\n      loading: false,\n      // 总数\n      total: 0,\n      // 编辑对话框\n      editDialog: {\n        visible: false,\n        loading: false,\n        form: {\n          id: null,\n          orderNo: '',\n          customerName: '',\n          productName: '',\n          startTime: '',\n          endTime: '',\n          status: '',\n          remark: ''\n        },\n        rules: {\n          startTime: [\n            { required: true, message: '请选择开始时间', trigger: 'change' }\n          ],\n          endTime: [\n            { required: true, message: '请选择结束时间', trigger: 'change' }\n          ]\n        }\n      },\n      // 筛选表单\n      filterForm: {\n        planNo: '',\n        orderNo: '',\n        status: '',\n        startDate: '',\n        endDate: '',\n        pageNum: 1,\n        pageSize: 10\n      },\n      dateRange: [],\n      // 日历视图设置\n      calendarView: 'month',\n      weekDays: [],\n      // 对话框设置\n      dialogVisible: false,\n      dialogTitle: '创建排产计划',\n      planForm: {\n        id: null,\n        orderId: '',\n        productId: '',\n        planQuantity: 1,\n        dateRange: [],\n        priority: 1,\n        remark: ''\n      },\n      planRules: {\n        orderId: [{ required: true, message: '请选择关联订单', trigger: 'change' }],\n        productId: [{ required: true, message: '请选择生产产品', trigger: 'change' }],\n        planQuantity: [{ required: true, message: '请输入计划数量', trigger: 'blur' }],\n        dateRange: [{ required: true, message: '请选择生产日期', trigger: 'change' }]\n      },\n      submitLoading: false,\n      // 选项数据\n      orderOptions: [\n        { value: 1, label: '上海某科技有限公司', orderNo: 'DD20231001001' },\n        { value: 2, label: '北京某贸易有限公司', orderNo: 'DD20231005002' },\n        { value: 3, label: '广州某电子科技公司', orderNo: 'DD20230925003' }\n      ],\n      productOptions: [\n        { value: 1, label: '智能手机A' },\n        { value: 2, label: '笔记本电脑B' },\n        { value: 3, label: '平板电脑C' },\n        { value: 4, label: '智能手表D' },\n        { value: 5, label: '智能音箱E' }\n      ],\n      calendarPlans: []\n    }\n  },\n  watch: {\n    dateRange(val) {\n      if (val && val.length === 2) {\n        this.filterForm.startDate = val[0]\n        this.filterForm.endDate = val[1]\n      } else {\n        this.filterForm.startDate = ''\n        this.filterForm.endDate = ''\n      }\n    },\n    calendarView() {\n      if (this.calendarView === 'week') {\n        this.generateWeekDays()\n      }\n    }\n  },\n  created() {\n    this.getList()\n    this.generateWeekDays()\n  },\n  methods: {\n    /** 获取生产计划列表 */\n    async getList() {\n      this.loading = true\n      try {\n        const res = await productionApi.list({\n          filters: {\n            orderNo: this.queryParams.orderNo,\n            customerName: this.queryParams.customerName,\n            status: this.queryParams.status,\n            dateRange: this.queryParams.dateRange\n          },\n          pagination: {\n            pageNum: this.queryParams.pageNum,\n            pageSize: this.queryParams.pageSize\n          }\n        })\n        this.tableData = res.records\n        this.total = res.total\n      } catch (error) {\n        console.error('获取生产计划列表失败:', error)\n        this.$message.error('获取生产计划列表失败')\n      } finally {\n        this.loading = false\n      }\n    },\n\n    /** 搜索按钮操作 */\n    handleQuery() {\n      this.queryParams.pageNum = 1\n      this.getList()\n    },\n\n    /** 重置按钮操作 */\n    resetQuery() {\n      this.queryParams = {\n        pageNum: 1,\n        pageSize: 10,\n        orderNo: '',\n        customerName: '',\n        status: '',\n        dateRange: []\n      }\n      this.getList()\n    },\n\n    /** 编辑按钮操作 */\n    handleEdit(row) {\n      this.editDialog.form = {\n        id: row.id,\n        orderNo: row.orderNo,\n        customerName: row.customerName,\n        productName: row.productName,\n        startTime: row.startTime,\n        endTime: row.estimatedEndTime,\n        status: row.status,\n        remark: row.description\n      }\n      this.editDialog.visible = true\n    },\n\n    /** 提交编辑 */\n    async submitEdit() {\n      this.$refs.editForm.validate(async valid => {\n        if (valid) {\n          this.editDialog.loading = true\n          try {\n            await productionApi.updatePlan(this.editDialog.form)\n            this.$message.success('更新成功')\n            this.editDialog.visible = false\n            this.getList()\n          } catch (error) {\n            console.error('更新生产计划失败:', error)\n            this.$message.error('更新生产计划失败')\n          } finally {\n            this.editDialog.loading = false\n          }\n        }\n      })\n    },\n\n    /** 取消编辑 */\n    cancelEdit() {\n      this.editDialog.visible = false\n      this.editDialog.form = {\n        id: null,\n        orderNo: '',\n        customerName: '',\n        productName: '',\n        startTime: '',\n        endTime: '',\n        status: '',\n        remark: ''\n      }\n    },\n\n    /** 每页显示条数改变 */\n    handleSizeChange(val) {\n      this.queryParams.pageSize = val\n      this.getList()\n    },\n\n    /** 当前页改变 */\n    handleCurrentChange(val) {\n      this.queryParams.pageNum = val\n      this.getList()\n    },\n\n    // 格式化日期\n    formatDateTime(date) {\n      return date ? moment(date).format('YYYY-MM-DD HH:mm:ss') : '-'\n    },\n\n    // 格式化状态\n    formatStatus(status) {\n      const statusMap = this.statusOptions.reduce((acc, curr) => {\n        acc[curr.value] = curr.label\n        return acc\n      }, {})\n      return statusMap[status] || '未知'\n    },\n\n    // 获取状态标签类型\n    getStatusType(status) {\n      const typeMap = {\n        0: 'info',\n        1: 'warning',\n        2: 'primary',\n        3: 'success',\n        4: 'success'\n      }\n      return typeMap[status] || 'info'\n    },\n\n    // 生成日历数据\n    generateCalendarData() {\n      this.calendarPlans = this.tableData.filter(item => item.status !== 3).map(item => {\n        const startDate = new Date(item.startDate)\n        const endDate = new Date(item.endDate)\n        const days = []\n        \n        let currentDate = new Date(startDate)\n        while (currentDate <= endDate) {\n          days.push(new Date(currentDate))\n          currentDate.setDate(currentDate.getDate() + 1)\n        }\n        \n        return {\n          id: item.id,\n          planNo: item.planNo,\n          productName: item.productName,\n          planQuantity: item.planQuantity,\n          days: days,\n          status: item.status,\n          startTime: '09:00',\n          endTime: '18:00'\n        }\n      })\n    },\n    // 生成周视图数据\n    generateWeekDays() {\n      const today = new Date()\n      const weekStart = new Date(today)\n      const dayOfWeek = today.getDay() || 7\n      weekStart.setDate(today.getDate() - dayOfWeek + 1)\n      \n      this.weekDays = []\n      for (let i = 0; i < 7; i++) {\n        const date = new Date(weekStart)\n        date.setDate(weekStart.getDate() + i)\n        \n        this.weekDays.push({\n          date: this.formatDate(date, 'MM-dd'),\n          dayName: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'][i],\n          fullDate: this.formatDate(date, 'yyyy-MM-dd'),\n          plans: []\n        })\n      }\n      \n      // 填充周视图计划数据\n      if (this.calendarPlans.length > 0) {\n        this.calendarPlans.forEach(plan => {\n          plan.days.forEach(day => {\n            const dayStr = this.formatDate(day, 'yyyy-MM-dd')\n            const weekDay = this.weekDays.find(d => d.fullDate === dayStr)\n            if (weekDay) {\n              weekDay.plans.push({\n                id: plan.id,\n                productName: plan.productName,\n                planQuantity: plan.planQuantity,\n                status: plan.status,\n                startTime: plan.startTime,\n                endTime: plan.endTime\n              })\n            }\n          })\n        })\n      }\n    },\n    // 获取指定日期的计划\n    getCalendarPlans(date) {\n      const dateStr = this.formatDate(date, 'yyyy-MM-dd')\n      return this.calendarPlans.filter(plan => {\n        return plan.days.some(day => this.formatDate(day, 'yyyy-MM-dd') === dateStr)\n      })\n    },\n    // 格式化日期\n    formatDate(date, format) {\n      const year = date.getFullYear()\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      \n      if (format === 'yyyy-MM-dd') {\n        return `${year}-${month}-${day}`\n      } else if (format === 'MM-dd') {\n        return `${month}-${day}`\n      }\n      \n      return `${year}-${month}-${day}`\n    },\n    // 计算完成百分比\n    calculateProgress(row) {\n      if (row.planQuantity === 0) return 0\n      return Math.round((row.actualQuantity / row.planQuantity) * 100)\n    },\n    // 百分比格式化\n    percentFormat(percent) {\n      return percent + '%'\n    },\n    // 获取状态名称\n    getStatusName(status) {\n      const nameMap = {\n        0: '待生产',\n        1: '生产中',\n        2: '已完成',\n        3: '已取消'\n      }\n      return nameMap[status] || '未知'\n    },\n    // 查询\n    handleFilter() {\n      this.filterForm.pageNum = 1\n      this.getList()\n    },\n    // 重置筛选条件\n    resetFilter() {\n      this.filterForm = {\n        planNo: '',\n        orderNo: '',\n        status: '',\n        startDate: '',\n        endDate: '',\n        pageNum: 1,\n        pageSize: 10\n      }\n      this.dateRange = []\n      this.getList()\n    },\n    // 查看详情\n    handleDetail(row) {\n      this.$router.push({\n        name: 'ProductionPlanDetail',\n        params: { id: row.id }\n      })\n    },\n    // 开始生产\n    handleStart(row) {\n      this.$confirm('确认开始生产该计划?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // 模拟请求\n        const index = this.tableData.findIndex(item => item.id === row.id)\n        if (index !== -1) {\n          this.tableData[index].status = 1\n          this.$message.success('已开始生产')\n          \n          // 更新日历数据\n          this.generateCalendarData()\n          if (this.calendarView === 'week') {\n            this.generateWeekDays()\n          }\n        }\n      }).catch(() => {})\n    },\n    // 完成生产\n    handleComplete(row) {\n      this.$confirm('确认完成该生产计划?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // 模拟请求\n        const index = this.tableData.findIndex(item => item.id === row.id)\n        if (index !== -1) {\n          this.tableData[index].status = 2\n          this.tableData[index].actualQuantity = this.tableData[index].planQuantity\n          this.$message.success('生产计划已完成')\n          \n          // 更新日历数据\n          this.generateCalendarData()\n          if (this.calendarView === 'week') {\n            this.generateWeekDays()\n          }\n        }\n      }).catch(() => {})\n    },\n    // 取消计划\n    handleCancel(row) {\n      this.$confirm('确认取消该生产计划?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // 模拟请求\n        const index = this.tableData.findIndex(item => item.id === row.id)\n        if (index !== -1) {\n          this.tableData[index].status = 3\n          this.$message.success('生产计划已取消')\n          \n          // 更新日历数据\n          this.generateCalendarData()\n          if (this.calendarView === 'week') {\n            this.generateWeekDays()\n          }\n        }\n      }).catch(() => {})\n    },\n    // 创建排产计划\n    handleCreatePlan() {\n      this.dialogTitle = '创建排产计划'\n      this.planForm = {\n        id: null,\n        orderId: '',\n        productId: '',\n        planQuantity: 1,\n        dateRange: [],\n        priority: 1,\n        remark: ''\n      }\n      this.dialogVisible = true\n      this.$nextTick(() => {\n        this.$refs.planForm && this.$refs.planForm.clearValidate()\n      })\n    },\n    // 提交排产计划\n    submitPlan() {\n      this.$refs.planForm.validate(valid => {\n        if (!valid) return\n        \n        this.submitLoading = true\n        \n        // 模拟提交请求\n        setTimeout(() => {\n          if (this.planForm.id) {\n            // 更新\n            const index = this.tableData.findIndex(item => item.id === this.planForm.id)\n            if (index !== -1) {\n              const orderInfo = this.orderOptions.find(o => o.value === this.planForm.orderId)\n              const productInfo = this.productOptions.find(p => p.value === this.planForm.productId)\n              \n              this.tableData[index] = {\n                ...this.tableData[index],\n                orderNo: orderInfo ? orderInfo.orderNo : '',\n                productName: productInfo ? productInfo.label : '',\n                planQuantity: this.planForm.planQuantity,\n                startDate: this.planForm.dateRange[0],\n                endDate: this.planForm.dateRange[1],\n                priority: this.planForm.priority,\n                remark: this.planForm.remark\n              }\n            }\n            this.$message.success('排产计划更新成功')\n          } else {\n            // 创建\n            const orderInfo = this.orderOptions.find(o => o.value === this.planForm.orderId)\n            const productInfo = this.productOptions.find(p => p.value === this.planForm.productId)\n            \n            const newPlan = {\n              id: Date.now(),\n              planNo: 'PP' + new Date().getTime().toString().substring(3),\n              orderNo: orderInfo ? orderInfo.orderNo : '',\n              productName: productInfo ? productInfo.label : '',\n              planQuantity: this.planForm.planQuantity,\n              actualQuantity: 0,\n              startDate: this.planForm.dateRange[0],\n              endDate: this.planForm.dateRange[1],\n              status: 0,\n              priority: this.planForm.priority,\n              remark: this.planForm.remark\n            }\n            \n            this.tableData.unshift(newPlan)\n            this.total += 1\n            this.$message.success('排产计划创建成功')\n          }\n          \n          this.dialogVisible = false\n          this.submitLoading = false\n          \n          // 更新日历数据\n          this.generateCalendarData()\n          if (this.calendarView === 'week') {\n            this.generateWeekDays()\n          }\n        }, 1000)\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.filter-container {\n  margin-bottom: 20px;\n}\n.filter-item-container {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.filter-item {\n  margin-right: 15px;\n  margin-bottom: 10px;\n  display: flex;\n  align-items: center;\n}\n.filter-item .label {\n  margin-right: 5px;\n}\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n.calendar-day {\n  height: 100%;\n  padding: 2px;\n  overflow: hidden;\n}\n.day-number {\n  font-size: 14px;\n  margin-bottom: 5px;\n}\n.calendar-event {\n  font-size: 12px;\n  padding: 2px 4px;\n  margin-bottom: 2px;\n  border-radius: 2px;\n  color: #fff;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.status-0 {\n  background-color: #409EFF;\n}\n.status-1 {\n  background-color: #67C23A;\n}\n.status-2 {\n  background-color: #E6A23C;\n}\n.status-3 {\n  background-color: #F56C6C;\n}\n.week-view {\n  border: 1px solid #EBEEF5;\n  border-radius: 4px;\n}\n.week-header {\n  display: flex;\n  background-color: #f5f7fa;\n  border-bottom: 1px solid #EBEEF5;\n}\n.week-day {\n  flex: 1;\n  text-align: center;\n  padding: 10px;\n  border-right: 1px solid #EBEEF5;\n}\n.week-day:last-child {\n  border-right: none;\n}\n.day-name {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n.week-body {\n  display: flex;\n  height: 400px;\n}\n.week-day-content {\n  flex: 1;\n  padding: 10px;\n  border-right: 1px solid #EBEEF5;\n  overflow-y: auto;\n}\n.week-day-content:last-child {\n  border-right: none;\n}\n.week-event {\n  padding: 10px;\n  margin-bottom: 10px;\n  border-radius: 4px;\n  color: #fff;\n}\n.event-time {\n  font-size: 12px;\n  margin-bottom: 5px;\n}\n.event-title {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n.event-quantity {\n  font-size: 12px;\n}\n</style> "]}]}